<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:jaxrs="http://cxf.apache.org/blueprint/jaxrs"
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0
        http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schemas/blueprint/jaxrs.xsd">

	<service auto-export="interfaces">
		<bean class="org.ops4j.pax.web.extender.whiteboard.runtime.DefaultResourceMapping">
			<property name="alias" value="/static/backbone"/>
			<property name="path" value="/webresources"/>
		</bean>
	</service>

	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="underscore"/>
			<argument value="backbone/underscore-1.3.3"/>
			<argument value="backbone/underscore-1.3.3.min"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="underscore"/>
			<argument>
				<set/>
			</argument>
			<argument value="_"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="backbone"/>
			<argument value="backbone/backbone-0.9.2"/>
			<argument value="backbone/backbone-0.9.2.min"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="backbone"/>
			<argument>
				<set>
					<value>underscore</value>
					<value>jquery</value>
				</set>
			</argument>
			<argument value="Backbone"/>
		</bean>
	</service>
	
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="handlebars.runtime"/>
			<argument value="backbone/handlebars.runtime-1.0.rc.1"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="handlebars.runtime"/>
			<argument>
				<set>
					<value>handlebars.runtime</value>
				</set>
			</argument>
		</bean>
	</service>
	
	<!-- TODO: Mustache is deprecated, please use Handlebars precompilation -->
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="mustache"/>
			<argument value="backbone/mustache-0.5.2"/>
			<argument value="backbone/mustache-0.5.2.min"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="mustache"/>
			<argument>
				<set/>
			</argument>
			<argument value="Mustache"/>
		</bean>
	</service>
	
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="sugar"/>
			<argument value="backbone/sugar-1.3.min"/>
			<argument value="backbone/sugar-1.3.min"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="sugar"/>
			<argument>
				<set/>
			</argument>
			<argument value="Date"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="sugar_id"/>
			<argument value="backbone/sugar_id"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptShim">
			<argument value="sugar_id"/>
			<argument>
				<set>
					<value>sugar</value>
				</set>
			</argument>
			<argument value="Date"/>
		</bean>
	</service>
	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="livevalidation"/>
			<argument value="backbone/livevalidation_amd-1.3"/>
		</bean>
	</service>

	<service auto-export="all-classes">
		<bean class="org.soluvas.web.site.JavaScriptModule">
			<argument value="pref.locale"/>
			<argument value="backbone/pref.locale"/>
		</bean>
	</service>

<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/backbone/underscore-1.3.3.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/backbone/mustache-0.5.2.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/backbone/sugar-1.3.min.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/backbone/sugar_id.js"/> -->
<!-- 			<argument value="-90"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/backbone/backbone-0.9.2.js"/> -->
<!-- 			<argument value="-50"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->

	<reference-list id="jsModules" interface="org.soluvas.web.site.JavaScriptModule" availability="optional"/>
	<reference-list id="jsShims" interface="org.soluvas.web.site.JavaScriptShim" availability="optional"/>
	<jaxrs:server id="requireServer" address="/require">
		<jaxrs:serviceBeans>
			<bean class="org.soluvas.web.backbone.RequireResource">
				<argument ref="jsModules"/>
				<argument ref="jsShims"/>
			</bean>
		</jaxrs:serviceBeans>
	</jaxrs:server>

</blueprint>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cxf="http://cxf.apache.org/blueprint/core"
    xmlns:jaxrs="http://cxf.apache.org/blueprint/jaxrs"
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0
        http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schemas/blueprint/jaxrs.xsd
        http://cxf.apache.org/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd">

<!-- 	<cxf:bus> -->
<!-- 		<cxf:features> -->
<!-- 			<cxf:logging /> -->
<!-- 		</cxf:features> -->
<!-- 	</cxf:bus> -->

	<service auto-export="interfaces">
		<bean class="org.ops4j.pax.web.extender.whiteboard.runtime.DefaultResourceMapping">
			<property name="alias" value="/static/js/org.soluvas.web.backbone"/>
			<property name="path" value="/js"/>
		</bean>
	</service>

	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="underscore"/>
			<argument value="js/org.soluvas.web.backbone/underscore-1.3.3"/>
			<argument value="js/org.soluvas.web.backbone/underscore-1.3.3.min"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="underscore"/>
			<argument>
				<set/>
			</argument>
			<argument value="_"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="backbone"/>
			<argument value="js/org.soluvas.web.backbone/backbone-0.9.2"/>
			<argument value="js/org.soluvas.web.backbone/backbone-0.9.2.min"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="backbone"/>
			<argument>
				<set>
					<value>underscore</value>
					<value>jquery</value>
				</set>
			</argument>
			<argument value="Backbone"/>
		</bean>
	</service>
	
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="handlebars"/>
			<argument value="js/org.soluvas.web.backbone/handlebars-1.0.rc.1"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="handlebars"/>
			<argument>
				<set />
			</argument>
			<argument value="Handlebars" />
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="handlebars.runtime"/>
			<argument value="js/org.soluvas.web.backbone/handlebars-1.0.rc.1"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="handlebars.runtime"/>
			<argument>
				<set />
			</argument>
			<argument value="Handlebars" />
		</bean>
	</service>
	
	<!-- TODO: Mustache.js is deprecated, please use Handlebars precompilation -->
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="mustache"/>
			<argument value="js/org.soluvas.web.backbone/mustache-0.5.2"/>
			<argument value="js/org.soluvas.web.backbone/mustache-0.5.2.min"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="mustache"/>
			<argument>
				<set/>
			</argument>
			<argument value="Mustache"/>
		</bean>
	</service>
	
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="sugar"/>
			<argument value="js/org.soluvas.web.backbone/sugar-1.3.min"/>
			<argument value="js/org.soluvas.web.backbone/sugar-1.3.min"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="sugar"/>
			<argument>
				<set/>
			</argument>
			<argument value="Date"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="sugar_id"/>
			<argument value="js/org.soluvas.web.backbone/sugar_id"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="sugar_id"/>
			<argument>
				<set>
					<value>sugar</value>
				</set>
			</argument>
			<argument value="Date"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="livevalidation"/>
			<argument value="js/org.soluvas.web.backbone/livevalidation_amd-1.3"/>
		</bean>
	</service>

	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="pref.locale"/>
			<argument value="js/org.soluvas.web.backbone/pref.locale"/>
		</bean>
	</service>

	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptModuleImpl">
			<argument value="uritemplate"/>
			<argument value="js/org.soluvas.web.backbone/uritemplate"/>
		</bean>
	</service>
	<service auto-export="interfaces">
		<bean class="org.soluvas.web.site.JavaScriptShimImpl">
			<argument value="uritemplate"/>
			<argument>
				<set />
			</argument>
			<argument value="UriTemplate"/>
		</bean>
	</service>

<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/js/org.soluvas.web.backbone/underscore-1.3.3.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/js/org.soluvas.web.backbone/mustache-0.5.2.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/js/org.soluvas.web.backbone/sugar-1.3.min.js"/> -->
<!-- 			<argument value="-100"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/js/org.soluvas.web.backbone/sugar_id.js"/> -->
<!-- 			<argument value="-90"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->
<!-- 	<service auto-export="interfaces"> -->
<!-- 		<service-properties> -->
<!-- 			<entry key="region" value="footer"/> -->
<!-- 		</service-properties> -->
<!-- 		<bean class="org.soluvas.web.site.JavaScriptLinkImpl"> -->
<!-- 			<argument value="/static/js/org.soluvas.web.backbone/backbone-0.9.2.js"/> -->
<!-- 			<argument value="-50"/> -->
<!-- 		</bean> -->
<!-- 	</service> -->

	<reference id="webAddressSupplier" interface="com.google.common.base.Supplier"
		filter="(&amp;(tenantId=berbatik)(tenantEnv=dev)(suppliedClass=org.soluvas.web.site.webaddress.WebAddress))" />
	<reference-list id="jsModules" interface="org.soluvas.web.site.JavaScriptModule" availability="optional"/>
	<reference-list id="jsShims" interface="org.soluvas.web.site.JavaScriptShim" availability="optional"/>
	
	<service auto-export="interfaces">
		<service-properties>
			<entry key="clientId" value="berbatik"/>
			<entry key="tenantId" value="berbatik"/>
			<entry key="tenantEnv" value="dev"/>
			<entry key="type" value="jaxrs"/>
			<entry key="address" value="api"/>
		</service-properties>
		<bean class="java.util.ArrayList">
			<argument>
				<list>
					<bean class="org.soluvas.web.backbone.RequireResource">
						<argument ref="webAddressSupplier" />
						<argument ref="jsModules" />
						<argument ref="jsShims" />
					</bean>
				</list>
			</argument>
		</bean>
	</service>
	

</blueprint>
